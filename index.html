<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDEA ç®¡ç†ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { background-color: #f8fafc; font-family: -apple-system, "Microsoft JhengHei", sans-serif; overflow-x: hidden; }
        .sidebar-bg { background-color: #2d333b; }
        .active-item { background-color: #243b32; border-left: 4px solid #4ade80; color: #4ade80; }
        .menu-item:hover:not(.active-item) { background-color: #3d444d; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useContext, createContext, Fragment } = React;
        const LIFF_ID = "2005868456-cfANNVou"; 
        const API_URL = "https://tdea.fangwl591021.workers.dev/"; 
        const UserContext = createContext(null);

        async function callAPI(action, data = {}) {
            try {
                const response = await fetch(`${API_URL}?action=${action}`, { 
                    method: 'POST', body: JSON.stringify({ action, ...data }) 
                });
                return await response.json();
            } catch (err) { return { success: false, message: "é€£ç·šå¤±æ•—" }; }
        }

        // --- 1. åš´æ ¼æ¬Šé™ä¿è­·çµ„ä»¶ ---
        const AuthGuard = ({ children }) => {
            const [authState, setAuthState] = useState({ status: "LOADING", user: null });

            useEffect(() => {
                const init = async () => {
                    try {
                        await liff.init({ liffId: LIFF_ID });
                        if (!liff.isLoggedIn()) { liff.login(); return; }
                        const profile = await liff.getProfile();
                        const res = await callAPI('check', { userId: profile.userId });
                        
                        // ğŸŒŸ å¼·åˆ¶æª¢æŸ¥èº«åˆ†ï¼Œè‹¥é admin å‰‡ç„¡æ¬Šåœç•™
                        if (res.status === 'admin') {
                            setAuthState({ status: "AUTHORIZED", user: profile });
                        } else {
                            alert("âš ï¸ éç®¡ç†äººå“¡ç¦æ­¢é€²å…¥å¾Œå°ï¼\nç³»çµ±å°‡ç‚ºæ‚¨è·³è½‰è‡³å ±åå¤§å»³ã€‚");
                            window.location.replace("lobby.html");
                        }
                    } catch (err) { setAuthState({ status: "ERROR" }); }
                };
                init();
            }, []);

            if (authState.status === "LOADING") return <div className="h-screen flex items-center justify-center text-gray-400 font-bold uppercase tracking-widest animate-pulse">Security Checking...</div>;
            return <UserContext.Provider value={authState.user}>{children}</UserContext.Provider>;
        };

        // ... æ­¤è™•ä¿æŒåŸæœ‰çš„ Dashboard, ActivityManagementModule ç­‰ React ä»£ç¢¼ ...
        // (ç‚ºäº†ç¯€çœç¯‡å¹…ï¼Œè«‹ä¿ç•™æ‚¨ index.html/main.html åŸæœ‰çš„ UI ä»£ç¢¼)

        const App = () => {
            const [view, setView] = useState('dashboard');
            return (
                <AuthGuard>
                    <div className="flex h-screen overflow-hidden">
                        {/* å´é‚Šæ¬„èˆ‡ä¸»è¦å…§å®¹ UI */}
                        <div className="w-72 sidebar-bg text-gray-300 flex flex-col shrink-0 shadow-2xl">
                             <div className="p-10 border-b border-gray-700 text-[#4ade80] text-3xl font-black text-center italic tracking-widest uppercase leading-none">TDEA<br/><span className="text-[10px] tracking-widest font-bold opacity-30 not-italic uppercase">HUB v11.1</span></div>
                             <nav className="flex-1 mt-8">
                                <div className={`px-10 py-6 cursor-pointer flex items-center gap-5 ${view==='dashboard'?'active-item':'menu-item'}`} onClick={()=>setView('dashboard')}><span>ç³»çµ±ç¸½è¦½</span></div>
                                <div className={`px-10 py-6 cursor-pointer flex items-center gap-5 ${view==='activity'?'active-item':'menu-item'}`} onClick={()=>setView('activity')}><span>æ´»å‹•ç®¡ç†æ§åˆ¶å°</span></div>
                             </nav>
                             <div className="p-8 border-t border-gray-700"><button onClick={()=>location.reload()} className="w-full bg-gray-700 hover:bg-red-500 text-white py-3 rounded-2xl text-xs font-bold transition-all uppercase tracking-widest shadow-xl">å®‰å…¨ç™»å‡º</button></div>
                        </div>
                        <main className="flex-1 overflow-auto bg-[#f8fafc] no-scrollbar">
                            <div className="p-10 text-gray-300 font-bold italic uppercase tracking-widest">Admin Access Only - ç³»çµ±é‹è¡Œä¸­...</div>
                        </main>
                    </div>
                </AuthGuard>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
