<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>TDEA ç³»çµ±å…¥å£</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .fade-in { animation: fadeIn .4s ease-in-out forwards; }
    @keyframes fadeIn { from{opacity:0; transform: translateY(10px);} to{opacity:1; transform: translateY(0);} }
    .hidden { display: none !important; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">

  <!-- ğŸŸ¢ é©—è­‰ä¸­ -->
  <div id="splash" class="text-center fade-in">
    <div class="w-16 h-16 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin mx-auto mb-4"></div>
    <h2 class="text-gray-500 font-bold">èº«åˆ†æ ¸å°ä¸­...</h2>
  </div>

  <!-- â³ å¯©æ ¸ä¸­ -->
  <div id="pendingPage" class="bg-white rounded-3xl shadow-xl p-10 w-full max-w-sm text-center hidden fade-in">
    <div class="text-5xl mb-4">â³</div>
    <h2 class="text-xl font-bold text-gray-800 mb-2">ç®¡ç†æ¬Šé™å¯©æ ¸ä¸­</h2>
    <p class="text-gray-500 text-sm mb-6">æ‚¨çš„è³‡æ–™å·²é€å‡ºï¼Œç®¡ç†å“¡æ ¸å‡†å¾Œå³å¯é€²å…¥ã€Œå¾Œå°ç®¡ç†ä¸­å¿ƒã€ã€‚</p>
    <button onclick="window.location.replace('lobby.html')" class="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold mb-3 shadow-lg">å…ˆå»æ´»å‹•å ±åé </button>
    <button onclick="location.reload()" class="w-full bg-gray-100 text-gray-400 py-3 rounded-xl font-bold text-xs">å·²é–‹é€šï¼Ÿé‡æ–°æ•´ç†</button>
  </div>

<script>
const LIFF_ID  = '2005868456-cfANNVou';     
const API_URL  = 'https://tdea.fangwl591021.workers.dev/'; 

const $ = id => document.getElementById(id);
function showPage(pageId) { $('splash').classList.add('hidden'); $('pendingPage').classList.add('hidden'); $(pageId).classList.remove('hidden'); }

window.onload = async function() {
    try {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) { liff.login(); return; }
        const profile = await liff.getProfile();
        
        const response = await fetch(API_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'check', userId: profile.userId })
        });
        const result = await response.json();
        
        // ğŸŒŸ æ ¸å¿ƒåˆ†æµé‚è¼¯
        if (result.status === 'admin') {
            window.location.replace('index.html'); // åªæœ‰ç®¡ç†å“¡é€²å¾Œå°
        } 
        else if (result.status === 'member') {
            window.location.replace('lobby.html'); // ä¸€èˆ¬æœƒå“¡ç›´æ¥å»å ±åå¤§å»³
        }
        else if (result.status === 'pending') {
            showPage('pendingPage'); // å¯©æ ¸ä¸­é¡¯ç¤ºæç¤ºï¼Œä½†å¯è·³è½‰å ±åé 
        }
        else {
            window.location.replace('login.html'); // æœªè¨»å†Šå»ç¶å®šé 
        }
    } catch (err) { alert('é€£ç·šç•°å¸¸'); }
};
</script>
</body>
</html>
